---
sidebar: sidebar 
permalink: installation/monitor-health.html 
keywords: monitoring system health 
summary: データが利用可能であることを確認するには、HTTP リクエストをサポートする任意の監視システムを使用して、 Keystone Collector の正常性を監視できます。 
---
= Keystone Collector の健全性を監視する
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
HTTP リクエストをサポートする任意の監視システムを使用して、 Keystone Collector の健全性を監視できます。ヘルスを監視することで、 Keystoneダッシュボードでデータを利用できるようになります。

デフォルトでは、 Keystoneヘルス サービスは、localhost 以外の IP からの接続を受け入れません。Keystoneヘルスエンドポイントは `/uber/health`、 Keystone Collectorサーバーのすべてのインターフェースのポートでリッスンします `7777`。クエリを実行すると、エンドポイントから応答として、 Keystone Collector システムのステータスを示す JSON 出力を含む HTTP 要求ステータス コードが返されます。 JSON本体は、 `is_healthy`属性はブール値であり、コンポーネントごとの詳細なステータスリストは `component_details`属性。次に例を示します。

[listing]
----
$ curl http://127.0.0.1:7777/uber/health
{"is_healthy": true, "component_details": {"vicmet": "Running", "ks-collector": "Running", "ks-billing": "Running", "chronyd": "Running"}}
----
次のステータス コードが返されます。

* *200*: 監視対象のすべてのコンポーネントが正常であることを示します
* *503*: 1つ以上のコンポーネントが正常でないことを示します
* *403*: ヘルス ステータスを照会している HTTP クライアントが、許可されたネットワーク CIDR のリストである _allow_ リストに含まれていないことを示します。このステータスの場合、健康情報は返されません。 _allow_ リストは、ネットワーク CIDR 方式を使用して、どのネットワーク デバイスがKeystoneヘルス システムを照会できるかを制御します。このエラーが発生した場合は、* Keystone Collector 管理 TUI > 構成 > ヘルス モニタリング* から監視システムを _許可_ リストに追加してください。


.Linux ユーザーの方は、次の既知の問題に注意してください。

NOTE: *問題の説明*: Keystone Collector は、使用量計測システムの一部として多数のコンテナを実行します。 Red Hat Enterprise Linux 8.x サーバーが米国国防情報システム局 (DISA) のセキュリティ技術実装ガイド (STIG) ポリシーで強化されている場合、fapolicyd (ファイル アクセス ポリシー デーモン) に関する既知の問題が断続的に発生します。この問題は次のように認識されていますlink:https://bugzilla.redhat.com/show_bug.cgi?id=1907870["バグ 1907870"^]。 *回避策*: Red Hat Enterpriseで解決されるまで、 NetAppこの問題を回避するために、 `fapolicyd`許容モードに移行します。で/`etc/fapolicyd/fapolicyd.conf`の値を設定する `permissive = 1`。



== システムログを表示する

Keystone Collector システム ログを表示してシステム情報を確認したり、それらのログを使用してトラブルシューティングを実行したりできます。 Keystone Collector はホストの _journald_ ログ システムを使用し、システム ログは標準の _journalctl_ システム ユーティリティを通じて確認できます。ログを調べるには、次の主要なサービスを利用できます。

* ksコレクター
* ks-ヘルス
* ks-自動更新


メインのデータ収集サービス_ks-collector_は、JSON形式でログを生成します。 `run-id`スケジュールされた各データ収集ジョブに関連付けられた属性。以下は、標準的な使用状況データ収集の成功したジョブの例です。

[listing]
----
{"level":"info","time":"2022-10-31T05:20:01.831Z","caller":"light-collector/main.go:31","msg":"initialising light collector with run-id cdflm0f74cgphgfon8cg","run-id":"cdflm0f74cgphgfon8cg"}
{"level":"info","time":"2022-10-31T05:20:04.624Z","caller":"ontap/service.go:215","msg":"223 volumes collected for cluster a2049dd4-bfcf-11ec-8500-00505695ce60","run-id":"cdflm0f74cgphgfon8cg"}

{"level":"info","time":"2022-10-31T05:20:18.821Z","caller":"ontap/service.go:215","msg":"697 volumes collected for cluster 909cbacc-bfcf-11ec-8500-00505695ce60","run-id":"cdflm0f74cgphgfon8cg"}

{"level":"info","time":"2022-10-31T05:20:41.598Z","caller":"ontap/service.go:215","msg":"7 volumes collected for cluster f7b9a30c-55dc-11ed-9c88-005056b3d66f","run-id":"cdflm0f74cgphgfon8cg"}

{"level":"info","time":"2022-10-31T05:20:48.247Z","caller":"ontap/service.go:215","msg":"24 volumes collected for cluster a9e2dcff-ab21-11ec-8428-00a098ad3ba2","run-id":"cdflm0f74cgphgfon8cg"}

{"level":"info","time":"2022-10-31T05:20:48.786Z","caller":"worker/collector.go:75","msg":"4 clusters collected","run-id":"cdflm0f74cgphgfon8cg"}

{"level":"info","time":"2022-10-31T05:20:48.839Z","caller":"reception/reception.go:75","msg":"Sending file 65a71542-cb4d-bdb2-e9a7-a826be4fdcb7_1667193648.tar.gz type=ontap to reception","run-id":"cdflm0f74cgphgfon8cg"}

{"level":"info","time":"2022-10-31T05:20:48.840Z","caller":"reception/reception.go:76","msg":"File bytes 123425","run-id":"cdflm0f74cgphgfon8cg"}

{"level":"info","time":"2022-10-31T05:20:51.324Z","caller":"reception/reception.go:99","msg":"uploaded usage file to reception with status 201 Created","run-id":"cdflm0f74cgphgfon8cg"}
----
以下は、オプションのパフォーマンス データ収集の成功したジョブの例です。

[listing]
----
{"level":"info","time":"2022-10-31T05:20:51.324Z","caller":"sql/service.go:28","msg":"initialising MySql service at 10.128.114.214"}

{"level":"info","time":"2022-10-31T05:20:51.324Z","caller":"sql/service.go:55","msg":"Opening MySql db connection at server 10.128.114.214"}

{"level":"info","time":"2022-10-31T05:20:51.324Z","caller":"sql/service.go:39","msg":"Creating MySql db config object"}

{"level":"info","time":"2022-10-31T05:20:51.324Z","caller":"sla_reporting/service.go:69","msg":"initialising SLA service"}

{"level":"info","time":"2022-10-31T05:20:51.324Z","caller":"sla_reporting/service.go:71","msg":"SLA service successfully initialised"}

{"level":"info","time":"2022-10-31T05:20:51.324Z","caller":"worker/collector.go:217","msg":"Performance data would be collected for timerange: 2022-10-31T10:24:52~2022-10-31T10:29:52"}

{"level":"info","time":"2022-10-31T05:21:31.385Z","caller":"worker/collector.go:244","msg":"New file generated: 65a71542-cb4d-bdb2-e9a7-a826be4fdcb7_1667193651.tar.gz"}

{"level":"info","time":"2022-10-31T05:21:31.385Z","caller":"reception/reception.go:75","msg":"Sending file 65a71542-cb4d-bdb2-e9a7-a826be4fdcb7_1667193651.tar.gz type=ontap-perf to reception","run-id":"cdflm0f74cgphgfon8cg"}

{"level":"info","time":"2022-10-31T05:21:31.386Z","caller":"reception/reception.go:76","msg":"File bytes 17767","run-id":"cdflm0f74cgphgfon8cg"}

{"level":"info","time":"2022-10-31T05:21:33.025Z","caller":"reception/reception.go:99","msg":"uploaded usage file to reception with status 201 Created","run-id":"cdflm0f74cgphgfon8cg"}

{"level":"info","time":"2022-10-31T05:21:33.025Z","caller":"light-collector/main.go:88","msg":"exiting","run-id":"cdflm0f74cgphgfon8cg"}
----


== サポートバンドルを生成して収集する

Keystone Collector TUI を使用すると、サポート バンドルを生成し、サポートの問題を解決するためにサービス リクエストに追加できます。次の手順に従ってください。

.手順
. Keystone Collector 管理 TUI ユーティリティを起動します。
`$ keystone-collector-tui`
. *トラブルシューティング > サポート バンドルの生成* に移動します。image:tui-sup-bundl.png["トゥイスクリーン"]
. 生成されると、バンドルが保存される場所が表示されます。  FTP、SFTP、または SCP を使用してその場所に接続し、ログ ファイルをローカル システムにダウンロードします。image:tui-sup-bundl-2.png["トゥイスクリーン"]
. ファイルをダウンロードしたら、 Keystone ServiceNow サポート チケットに添付できます。チケットの発行については、以下を参照してください。link:../concepts/gssc.html["サービスリクエストの生成"] 。

